/*! Datepicker - v0.1.0 - 2013-04-25
* https://github.com/amazingsurge/jquery-datepicker
* Copyright (c) 2013 amazingSurge; Licensed MIT */
(function(e){var t=e.daypicker=function(a,s){this.el=e(a),this.options=e.extend(!0,{},t.defaults,s),this.format=this.parse_format(this.options.format||"mm/dd/yyyy"),this.init()};t.defaults={first_day_of_week:1,week_days:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],calendars:2,mode:"range",language:"english",views:["days","days"],format:"yyyy/mm/dd",tpl_wrapper:'<div class="calendar-wrap"></div>',tpl_content:'<div class="calendar"><table><thead><tr class="calendar-head"><th class="calendar-prev"></th><th class="calendar-caption"></th><th class="calendar-next"></th></tr></thead></table><table class="calendar-days"></table><table class="calendar-months"></table><table class="calendar-years"></table></div>'},t.prototype={constructor:t,init:function(){var t="";if(this.picker=e(this.options.tpl_wrapper).appendTo("body").on({click:e.proxy(this.click,this)}),this.is_input=this.el.is("input"),this.is_input?(this._input=this.el,this.el.on({focus:e.proxy(this.show,this)})):this._input="","single"===this.options.mode)t+=this.options.tpl_content;else for(var a=0;this.options.calendars>a;a++)t+=this.options.tpl_content;this.picker.append(t),this.view=this.options.views,this.calendar=this.picker.find(".calendar"),this.calendar_prev=this.calendar.find(".calendar-prev"),this.calendar_next=this.calendar.find(".calendar-next"),this.daypicker=this.calendar.find(".calendar-days"),this.monthpicker=this.calendar.find(".calendar-months"),this.yearpicker=this.calendar.find(".calendar-years");var s=this.calendar.outerWidth();if(this.picker.css("width",this.options.calendars*s+"px"),this.selected_date=[new Date],this.current_date=[new Date],"range"===this.options.mode&&(this.current_date[1]=new Date,this.selected_date[1]=new Date,this.current_date[0].setHours(0,0,0,0),this.current_date[1].setHours(0,0,0,0),this.selected_date[0].setHours(0,0,0,0),this.selected_date[1].setHours(0,0,0,0)),this.date_update(),"single"===this.options.mode)this.manage_views(0);else for(a=0;this.options.calendars>a;a++)this.manage_views(a);this.set_value()},show:function(){this.picker.show(),this.place();var t=this;e(window).scroll(function(){t.place()}),e(document).on("mousedown",function(a){0===e(a.target).closest(".calendar").length&&0===e(a.target).closest(t.el).length&&t.hide()})},hide:function(){this.picker.hide()},place:function(){var e=window.innerHeight,t=window.innerWidth,a=this.picker.outerHeight(),s=this.picker.outerWidth(),r=this.el.offset().top,i=this.el.offset().left,n=this.el.outerHeight(),h=this.el.outerWidth(),c=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,d=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,l=r-c,o=e-l-n,_=i-d,u=t-_-h;o>a?u>s-h?this.picker.css({left:_,top:l+n}):_>s-h?this.picker.css({left:_+h-s,top:l+n}):this.picker.css({left:_,top:l+n}):l>a?u>s-h?this.picker.css({left:_,top:l-a}):_>s-h?this.picker.css({left:_+h-s,top:l-a}):this.picker.css({left:_,top:l-a}):u>s-h?this.picker.css({left:_,top:l+n}):_>s-h?this.picker.css({left:_+h-s,top:l+n}):this.picker.css({left:_,top:l+n})},set_value:function(){if("single"===this.options.mode){var e=this.format_date(this.selected_date[0],this.format);this.el.val(e)}else if("range"===this.options.mode){var t=this.format_date(this.selected_date[0],this.format),a=this.format_date(this.selected_date[1],this.format);this.el.val(t+" - "+a)}},set_date:function(e,t,a){switch(t){case"day":e.setDate(a);break;case"month":e.setMonth(a);break;case"year":e.setYear(a)}},str_pad:function(e,t){for(e+="";t>e.length;)e="0"+e;return e},str_concat:function(){for(var e="",t=0;arguments.length>t;t++)e+=arguments[t]+"";return e},parse_format:function(e){var t=e.match(/[.\/\-\s].*?/),a=e.split(/\W+/)||a;if(!a||0===a.length)throw Error("Invalid date format.");return{separator:t,parts:a}},parse_date:function(e,t){var a,s=e.split(t.separator)||s;if(e=new Date,s.length===t.parts.length)for(var r=0,i=t.parts.length;i>r;r++){if(a=parseInt(s[r],10)||1,"1"===a)return;switch(t.parts[r]){case"dd":case"d":e.setDate(a);break;case"mm":case"m":e.setDate(a-1);break;case"yy":e.setFullYear(2e3+a);break;case"yyyy":e.setFullYear(a)}}return e},format_date:function(e,t){var a={d:e.getDate(),m:e.getMonth()+1,yy:(""+e.getFullYear()).substring(2),yyyy:e.getFullYear()};a.dd=(10>a.d?"0":"")+a.d,a.mm=(10>a.m?"0":"")+a.m,e=[];for(var s=0,r=t.parts.length;r>s;s++)e.push(a[t.parts[s]]);return e.join(t.separator)},date_update:function(){"single"===this.options.mode?(this.current_day=[this.current_date[0].getDate()],this.current_month=[this.current_date[0].getMonth()],this.current_year=[this.current_date[0].getFullYear()],this.selected_day=[this.selected_date[0].getDate()],this.selected_month=[this.selected_date[0].getMonth()],this.selected_year=[this.selected_date[0].getFullYear()]):"range"===this.options.mode&&(this.current_day=[this.current_date[0].getDate(),this.current_date[1].getDate()],this.current_month=[this.current_date[0].getMonth(),this.current_date[1].getMonth()],this.current_year=[this.current_date[0].getFullYear(),this.current_date[1].getFullYear()],this.selected_day=[this.selected_date[0].getDate(),this.selected_date[1].getDate()],this.selected_month=[this.selected_date[0].getMonth(),this.selected_date[1].getMonth()],this.selected_year=[this.selected_date[0].getFullYear(),this.selected_date[1].getFullYear()])},generate_daypicker:function(e){var t=new Date(this.current_year[e],this.current_month[e]+1,0).getDate(),a=new Date(this.current_year[e],this.current_month[e],2).getDay(),s=new Date(this.current_year[e],this.current_month[e],0).getDate(),r=a-this.options.first_day_of_week,i='<thead><tr class="calendar-week">';if("range"===this.options.mode){var n=(this.current_date[0],this.current_date[1],this.selected_date[0]),h=this.selected_date[1],c=[];e>0?this.current_year[e]===this.selected_year[e-1]?this.current_month[e]<=this.selected_month[e-1]?this.calendar_prev.eq(e).addClass("calendar-blocked"):this.calendar_prev.eq(e).hasClass("calendar-blocked")===!0&&this.calendar_prev.eq(e).removeClass("calendar-blocked"):this.calendar_prev.eq(e).hasClass("calendar-blocked")===!0&&this.calendar_prev.eq(e).removeClass("calendar-blocked"):this.current_year[e]===this.selected_year[e+1]?this.current_month[e]>=this.selected_month[e+1]?this.calendar_next.eq(e).addClass("calendar-blocked"):this.calendar_next.eq(e).hasClass("calendar-blocked")===!0&&this.calendar_next.eq(e).removeClass("calendar-blocked"):this.calendar_next.eq(e).hasClass("calendar-blocked")===!0&&this.calendar_next.eq(e).removeClass("calendar-blocked")}r=0>r?7+r:r,this.manage_header(this.options.months[this.current_month[e]]+" "+this.current_year[e],e);for(var d=0;7>d;d++)i+="<th>"+this.options.week_days[d]+"</th>";for(i+="</tr></thead>",i+="<tbody><tr>",d=0;42>d;d++){var l=d-r+1;if(d>0&&0===d%7&&(i+="</tr><tr>"),"single"===this.options.mode)i+=r>d?'<td class="otherMonthDay">'+(s-r+d+1)+"</td>":l>t?'<td class="otherMonthDay">'+(l-t)+"</td>":l===this.selected_day[e]?'<td class="is-active">'+l+"</td>":"<td>"+l+"</td>";else if("range"===this.options.mode){var o="",_=0;r>d?(c[d]=new Date(this.current_year[e],this.current_month[e]-1,s-r+d+1,0,0,0,0),o="otherMonthDay",0===e?Date.parse(c[d])===Date.parse(n)?o+=" is-active":c[d]>n&&h>=c[d]&&(o+=" in-range"):1===e&&(Date.parse(c[d])===Date.parse(h)?o+=" is-active":c[d]>=n&&h>c[d]&&(o+=" in-range")),_=s-r+d+1):d>t+r-1?(c[d]=new Date(this.current_year[e],this.current_month[e]+1,l-t,0,0,0,0),o="otherMonthDay",0===e?Date.parse(c[d])===Date.parse(n)?o+=" is-active":c[d]>n&&h>=c[d]&&(o+=" in-range"):1===e&&(Date.parse(c[d])===Date.parse(h)?o+=" is-active":c[d]>=n&&h>c[d]&&(o+=" in-range")),_=l-t):(c[d]=new Date(this.current_year[e],this.current_month[e],l,0,0,0,0),0===e?Date.parse(c[d])===Date.parse(n)?o="is-active":c[d]>n&&h>=c[d]?o="in-range":c[d]>h&&(o="is-untouchable"):1===e&&(Date.parse(c[d])===Date.parse(h)?o="is-active":c[d]>=n&&h>c[d]?o="in-range":n>c[d]&&(o="is-untouchable")),_=l),c[d]===n,i+='<td class="'+o+'">'+_+"</td>"}}i+="</tr>",this.daypicker.eq(e).html(i)},generate_monthpicker:function(e){this.manage_header(this.current_year[e],e);var t=this.options.months_short;if("range"===this.options.mode){var a=(new Date(this.current_date[0].getFullYear(),this.current_date[0].getMonth(),1,0,0,0,0),new Date(this.current_date[1].getFullYear(),this.current_date[1].getMonth(),1,1,0,0,0),new Date(this.selected_date[0].getFullYear(),this.selected_date[0].getMonth(),1,0,0,0,0)),s=new Date(this.selected_date[1].getFullYear(),this.selected_date[1].getMonth(),1,0,0,0,0),r=[];e>0?this.current_year[e]===this.selected_year[e-1]?this.calendar_prev.eq(e).addClass("calendar-blocked"):this.calendar_prev.eq(e).hasClass("calendar-blocked")===!0&&this.calendar_prev.eq(e).removeClass("calendar-blocked"):this.current_year[e]===this.selected_year[e+1]?this.calendar_next.eq(e).addClass("calendar-blocked"):this.calendar_next.eq(e).hasClass("calendar-blocked")===!0&&this.calendar_next.eq(e).removeClass("calendar-blocked")}for(var i="<tr>",n=0;12>n;n++)if(n>0&&0===n%3&&(i+="</tr><tr>"),"single"===this.options.mode)i+=n===this.current_month[e]&&this.selected_year[e]===this.current_year[e]?'<td class="calendar-month-'+n+' is-active">'+t[n]+"</td>":'<td class="calendar-month-'+n+'">'+t[n]+"</td>";else if("range"===this.options.mode){var h="calendar-month-"+n;r[n]=new Date(this.current_year[e],n,1,0,0,0,0),e>0?Date.parse(r[n])===Date.parse(s)?h+=" is-active":a>r[n]?h+=" is-untouchable":s>r[n]&&r[n]>=a&&(h+=" in-range"):Date.parse(r[n])===Date.parse(a)?h+=" is-active":r[n]>s?h+=" is-untouchable":s>=r[n]&&r[n]>a&&(h+=" in-range"),i+='<td class="'+h+'">'+t[n]+"</td>"}i+="</tr>",this.monthpicker.eq(e).html(i)},generate_yearpicker:function(e){if(this.manage_header(this.current_year[e]-7+" - "+(this.current_year[e]+4),e),"range"===this.options.mode){var t=(this.current_date[0].getFullYear(),this.current_date[1].getFullYear(),this.selected_date[0].getFullYear()),a=this.selected_date[1].getFullYear();e>0?this.current_year[e]===this.selected_year[e-1]?this.calendar_prev.eq(e).addClass("calendar-blocked"):this.calendar_prev.eq(e).hasClass("calendar-blocked")===!0&&this.calendar_prev.eq(e).removeClass("calendar-blocked"):this.current_year[e]===this.selected_year[e+1]?this.calendar_next.eq(e).addClass("calendar-blocked"):this.calendar_next.eq(e).hasClass("calendar-blocked")===!0&&this.calendar_next.eq(e).removeClass("calendar-blocked")}for(var s="<tr>",r=0;12>r;r++){var i=this.current_year[e]-7+r;if(r>0&&0===r%3&&(s+="</tr><tr>"),"single"===this.options.mode)s+=this.current_year[e]-7+r===this.current_year[e]?'<td class="is-active">'+(this.current_year[e]-7+r)+"</td>":"<td>"+(this.current_year[e]-7+r)+"</td>";else if("range"===this.options.mode){var n="";e>0?i===a?n+=" is-active":t>i?n+=" is-untouchable":a>i&&i>=t&&(n+=" in-range"):i===t?n+=" is-active":i>a?n+=" is-untouchable":a>=i&&i>t&&(n+=" in-range"),s+='<td class="'+n+'">'+i+"</td>"}}s+="</tr>",this.yearpicker.eq(e).html(s)},manage_header:function(e,t){this.calendar.eq(t).find(".calendar-caption").html(e)},manage_views:function(e){"days"===this.view[e]?(this.generate_daypicker(e),this.daypicker.eq(e).css("display","block"),this.monthpicker.eq(e).hide(),this.yearpicker.eq(e).hide()):"months"===this.view[e]?(this.generate_monthpicker(e),this.daypicker.eq(e).hide(),this.monthpicker.eq(e).css("display","block"),this.yearpicker.eq(e).hide()):"years"===this.view[e]&&(this.generate_yearpicker(e),this.daypicker.eq(e).hide(),this.monthpicker.eq(e).hide(),this.yearpicker.eq(e).css("display","block"))},prev:function(t){return e(this).hasClass("calendar-blocked")?!1:("days"===this.view[t]?(0>--this.current_month[t]&&(this.current_month[t]=11,this.current_year[t]--),this.set_date(this.current_date[t],"month",this.current_month[t]),this.set_date(this.current_date[t],"year",this.current_year[t])):"months"===this.view[t]?(this.current_year[t]--,this.set_date(this.current_date[t],"year",this.current_year[t])):"years"===this.view[t]&&(this.current_year[t]-=12,this.set_date(this.current_date[t],"year",this.current_year[t])),this.date_update(),this.manage_views(t),void 0)},next:function(t){return e(this).hasClass("calendar-blocked")?!1:("days"===this.view[t]?(12===++this.current_month[t]&&(this.current_month[t]=0,this.current_year[t]++),this.set_date(this.current_date[t],"month",this.current_month[t]),this.set_date(this.current_date[t],"year",this.current_year[t])):"months"===this.view[t]?(this.current_year[t]++,this.set_date(this.current_date[t],"year",this.current_year[t])):"years"===this.view[t]&&(this.current_year[t]+=12,this.set_date(this.current_date[t],"year",this.current_year[t])),this.date_update(),this.manage_views(t),void 0)},caption:function(e){if("days"===this.view[e])this.view[e]="months";else{if("months"!==this.view[e])return!1;this.view[e]="years"}this.date_update(),this.manage_views(e)},click:function(t){var a=e(t.target).closest("td, th"),s=function(t,a){var s;return e.each(t,function(e,t){t===a&&(s=e)}),s};if(1===a.length){var r=a.parent().parent().parent().parent(),i=s(this.calendar,r.get(0));switch(a[0].nodeName.toLowerCase()){case"th":switch(a[0].className){case"calendar-caption":this.caption(i);break;case"calendar-prev":this.prev(i);break;case"calendar-next":this.next(i)}break;case"td":var n=a.parent().parent().parent().attr("class"),h=a.hasClass("otherMonthDay"),c=a.hasClass("is-untouchable");switch(n){case"calendar-days":if(h!==!1||c!==!1)return!1;var d=parseInt(a.text(),10);this.set_date(this.selected_date[i],"day",d),this.set_date(this.current_date[i],"day",d),this.set_date(this.selected_date[i],"month",this.current_month[i]),this.set_date(this.current_date[i],"month",this.current_month[i]),this.set_date(this.selected_date[i],"year",this.current_year[i]),this.set_date(this.current_date[i],"year",this.current_year[i]),this.date_update(),"range"===this.options.mode&&(0===i?(this.current_date[0]>this.current_date[1]&&(this.set_date(this.current_date[i+1],"month",this.current_month[i]),this.set_date(this.current_date[i+1],"year",this.current_year[i]),this.date_update()),this.manage_views(i+1)):1===i&&(this.current_date[0]>this.current_date[1]&&(this.set_date(this.current_date[i-1],"month",this.current_month[i]),this.set_date(this.current_date[i-1],"year",this.current_year[i]),this.date_update()),this.manage_views(i-1))),this.manage_views(i),this.set_value(i);break;case"calendar-months":if(h!==!1||c!==!1)return!1;this.view[i]="days";var l=a.attr("class").match(/calendar\-month\-([0-9]+)/),o=Number(l[1]);this.set_date(this.current_date[i],"month",o),this.date_update(),this.manage_views(i);break;case"calendar-years":if(h!==!1||c!==!1)return!1;this.view[i]="months";var _=parseInt(a.text(),10);this.set_date(this.current_date[i],"year",_),this.date_update(),this.manage_views(i)}}}}},e.fn.datepicker=function(a){var s="datepicker",r=this.data(s);return r?a===!0?r:this:this.each(function(){return e(this).data(s,new t(this,a))})}})(jQuery);