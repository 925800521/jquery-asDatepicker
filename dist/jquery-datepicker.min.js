/*! Datepicker - v0.1.0 - 2013-10-12
* https://github.com/amazingsurge/jquery-datepicker
* Copyright (c) 2013 amazingSurge; Licensed MIT */
(function(e){var t=e.datepicker=function(s,a){this.$el=e(s);var i=[],r=this;e.each(this.$el.data(),function(e,t){i[e]=r._parseHtmlString(e,t)}),this.options=e.extend(!0,{},t.defaults,a,i),this._init()},s=e(document),a={},i=0;t.defaults={firstDayOfWeek:0,mode:"single",rangeMode:"default",displayMode:"dropdown",calendars:3,date:"today",rangeSeparator:"-",multipleSeparator:",",max:null,min:null,position:"bottom",alwaysShow:!1,onceClick:!1,selectableYear:[],selectableMonth:[],selectableDay:[],selectableDate:[],disableYear:[],disableMonth:[],disableDay:[],disableDate:[],lang:"en",views:["days"],format:"yyyy/mm/dd",namespace:"calendar",tplWrapper:function(){return'<div class="namespace-wrap"></div>'},tplContent:function(){return'<div class="namespace"><div class="namespace-head"><span class="namespace-prev"></span><span class="namespace-caption"></span><span class="namespace-next"></span></div><div class="namespace-days"></div><div class="namespace-months"></div><div class="namespace-years"></div></div>'},localize:function(e,t){a[e]=t},onRender:function(){},onChange:function(){},onBeforeShow:function(){},onShow:function(){},onBeforeHide:function(){},onHide:function(){}},t.defaults.localize("en",{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),t.defaults.localize("zh",{days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"]}),t.prototype={constructor:t,_stringSeparate:function(e,t){var s=RegExp("[.\\"+t+"\\s].*?"),t=e.match(s),a=e.split(t);return a},_parseHtmlString:function(e,s){var a=[],i=t.defaults;if("object"==typeof i[e]){for(var r,n=this._stringSeparate(s,","),h=0;n.length>h;h++)r=this._stringSeparate(n[h],">"),r=r.length>1?{from:r[0],to:r[1]}:r[0],a.push(r);return a}return s},_setDate:function(e,t,s){if("object"==typeof t)for(var a in t)switch(a){case"day":e.setDate(t[a]);break;case"month":e.setMonth(t[a]);break;case"year":e.setYear(t[a])}else switch(t){case"day":e.setDate(s);break;case"month":e.setMonth(s);break;case"year":e.setYear(s)}},_parseFormat:function(e){var t=e.match(/[.\/\-\s].*?/),s=e.split(/\W+/)||s;if(!s||0===s.length)throw Error("Invalid date format.");return{separator:t,parts:s}},_formatDate:function(e,t){var s={d:e.getDate(),m:e.getMonth()+1,yy:(""+e.getFullYear()).substring(2),yyyy:e.getFullYear()};s.dd=(10>s.d?"0":"")+s.d,s.mm=(10>s.m?"0":"")+s.m,e=[];for(var a=0,i=t.parts.length;i>a;a++)e.push(s[t.parts[a]]);return e.join(t.separator)},_parseDate:function(e,t){switch(typeof e){case"string":if(5>e.length){var s=new Date,a=s.getDate();s.setHours(0,0,0,0),s.setDate(a+Number(e))}else{var i,r=e.split(t.separator)||r,s=new Date;if(s.setHours(0,0,0,0),r.length===t.parts.length)for(var n=0,h=t.parts.length;h>n;n++){if(i=parseInt(r[n],10)||1,"1"===i)return;switch(t.parts[n]){case"dd":case"d":s.setDate(i);break;case"mm":case"m":s.setMonth(i-1);break;case"yy":s.setFullYear(2e3+i);break;case"yyyy":s.setFullYear(i)}}}break;case"number":var s=new Date,a=s.getDate();s.setHours(0,0,0,0),s.setDate(a+e)}return s},_parseAbleDate:function(e,t){for(var s=[],a=0,i=0;e.length>i;i++)if("string"==typeof e[i])s[a++]=this._parseDate(e[i],t);else if("object"==typeof e[i]){var r,n,h=e[i];for(var o in h)switch(o){case"from":r=h[o];break;case"to":n=h[o]}s[a++]=[this._parseDate(r,t),this._parseDate(n,t)]}return s},_parseAble:function(e){for(var t=[],s=0,a=0;e.length>a;a++)if("number"==typeof e[a])t[s++]=e[a];else if("string"==typeof e[a])t[s++]=Number(e[a]);else if("object"==typeof e[a]){var i,r,n=e[a];for(var h in n)switch(h){case"from":i=Number(n[h]);break;case"to":r=Number(n[h])}for(var o=i;r>=o;o++)t[s++]=o}return t},_init:function(){this.format=this._parseFormat("yyyy-mm-dd"),this.outputFormat=this._parseFormat(this.options.format||"yyyy/mm/dd"),this.mode=this.options.mode,this.namespace=this.options.namespace,this.focused=0,this.map={},this.pickerHide=!1,this.flag=i++;var t,s=this.options.tplWrapper().replace(/namespace/g,this.namespace),a=this.options.tplContent().replace(/namespace/g,this.namespace),r=e(s);switch(this.mode){case"single":t=1;break;case"range":t=2;break;case"multiple":t=this.options.calendars,this.options.views=["days"]}this.options.calendars=t;for(var n=0;this.options.calendars>n;n++)r.append(a),this.options.views[n]=this.options.views[n]||"days";r.attr("tabindex","0"),"inline"===this.options.displayMode?(this.$el.after(r).css({display:"none"}),this.picker=r,this.options.alwaysShow=!0,this.picker.on({focus:e.proxy(this.focus,this),blur:e.proxy(this.blur,this)})):"dropdown"===this.options.displayMode&&(this.picker=r.appendTo("body"),this.picker.css({position:"absolute"})),this.views=this.options.views,this.calendars=this.picker.find("."+this.namespace),this.calendarPrevs=this.calendars.find("."+this.namespace+"-prev"),this.calendarCaptions=this.calendars.find("."+this.namespace+"-caption"),this.calendarNexts=this.calendars.find("."+this.namespace+"-next"),this.daypickers=this.calendars.find("."+this.namespace+"-days"),this.monthpickers=this.calendars.find("."+this.namespace+"-months"),this.yearpickers=this.calendars.find("."+this.namespace+"-years"),this._initDate();for(var h=0;this.options.calendars>h;h++)this.manageViews(h);this.selected=!1,this.showed=!1,this.bound=!1,this.$el.is("input")&&(this.options.alwaysShow===!0?this.show():this.$el.on({focus:e.proxy(this.focus,this),blur:e.proxy(this.blur,this)}),this.setValue())},_initDate:function(){var e="today"===this.options.data?new Date:this._parseDate(this.options.date,this.format);this.currentDate=[new Date(e)],"multiple"===this.mode?(this.selectedDate=[],this.focusDate=new Date(e)):(this.selectedDate=[new Date(e)],this.focusDate=[new Date(e)]),this.currentDay=[],this.currentMonth=[],this.currentYear=[],this.currentMonthDate=[],this.currentYearDate=[],this.selectedDay=[],this.selectedMonth=[],this.selectedYear=[],this.selectedMonthDate=[],this.selectedYearDate=[],null!==this.options.max&&(this.maxDate=this._parseDate(this.options.max,this.format),this.maxMonth=this.maxDate.getMonth(),this.maxYear=this.maxDate.getFullYear()),null!==this.options.min&&(this.minDate=this._parseDate(this.options.min,this.format),this.minMonth=this.minDate.getMonth(),this.minYear=this.minDate.getFullYear());for(var t=0;this.options.calendars>t;t++)this.options.views[t]=this.options.views[t]||"days",this.currentDate[t]=this.currentDate[t]||new Date(e),"multiple"===this.mode?this._setDate(this.currentDate[t],"month",this.currentDate[t].getMonth()+t):(this.selectedDate[t]=this.selectedDate[t]||new Date(e),this.selectedDate[t].setHours(0,0,0,0),this.focusDate[t]=this.focusDate[t]||new Date(e),this.focusDate[t].setHours(0,0,0,0)),this.updateDate(t);switch(this.selectableDate=this.options.selectableDate.length>0?!0:!1,this.disableDate=this.options.disableDate.length>0?!0:!1,this.yearSelectable=this.options.selectableYear.length>0?!0:!1,this.monthSelectable=this.options.selectableMonth.length>0?!0:!1,this.daySelectable=this.options.selectableDay.length>0?!0:!1,this.yearDisable=this.options.disableYear.length>0?!0:!1,this.monthDisable=this.options.disableMonth.length>0?!0:!1,this.dayDisable=this.options.disableDay.length>0?!0:!1,this.options.rangeMode){case"section":this.options.selectableYear.length>0&&(this.selectableYear=!0),this.yearSection=this.yearSelectable===!0?this._parseAble(this.options.selectableYear):this.yearDisable===!0?this._parseAble(this.options.disableYear):null,this.monthSection=this.monthSelectable===!0?this._parseAble(this.options.selectableMonth):this.monthDisable===!0?this._parseAble(this.options.disableMonth):null,this.daySection=this.daySelectable===!0?this._parseAble(this.options.selectableDay):this.dayDisable===!0?this._parseAble(this.options.disableDay):null;break;case"array":this.arrayRange=this.selectableDate===!0?this._parseAbleDate(this.options.selectableDate,this.format):this.disableDate===!0?this._parseAbleDate(this.options.disableDate,this.format):null,this.arrayRangeMonth=this._changeDateLevel("month",this.arrayRange),this.arrayRangeYear=this._changeDateLevel("year",this.arrayRange)}},_changeDateLevel:function(t,s){var a=[];return e.each(s,function(e,s){if(void 0===s.length){var i="";switch(t){case"month":i=new Date(s.getFullYear(),s.getMonth(),1,0,0,0,0);break;case"year":i=new Date(s.getFullYear(),0,1,0,0,0,0)}}else if(2===s.length){var i=[];switch(t){case"month":i[0]=new Date(s[0].getFullYear(),s[0].getMonth(),1,0,0,0,0),i[1]=new Date(s[1].getFullYear(),s[1].getMonth(),1,0,0,0,0);break;case"year":i[0]=new Date(s[0].getFullYear(),0,1,0,0,0,0),i[1]=new Date(s[1].getFullYear(),0,1,0,0,0,0)}}a.push(i)}),a},_setPoint:function(e,t,s,a){var i=t;switch(e){case"=":s===a&&(i=!0);break;case"<":a>s&&(i=!0);break;case">":s>a&&(i=!0)}return i},_setSection:function(e,t,s,a){var i=e,r=Date.parse(t),n=Date.parse(s),h=Date.parse(a);return r>=n&&h>=r&&(i=!0),i},_inArray:function(t,s){return-1===e.inArray(t,s)?!1:!0},_setRange:function(t,s,a,i,r){var n=a,h=this;return"section"===t?n=this._inArray(i,r):"array"===t&&e.each(r,function(e,t){switch(t.length){case void 0:Date.parse(i)===Date.parse(t)&&(n=!0);break;case 2:n=h._setSection(n,i,t[0],t[1])}}),n},_judgeRange:function(t,s,a){var i,r,n=s,h=this.options.rangeMode,o=this;if(isUntouch=!1,"section"===h){switch(t){case"days":i=this.daySection,r=a.getDay();break;case"months":i=this.monthSection,r=a.getMonth();break;case"years":i=this.yearSection,r=a.getFullYear()}n=this._inArray(r,i)}else if("array"===h){switch(t){case"days":i=this.arrayRange;break;case"months":i=this.arrayRangeMonth;break;case"years":i=this.arrayRangeYear}e.each(i,function(e,t){switch(t.length){case void 0:Date.parse(a)===Date.parse(t)&&(n=!0);break;case 2:n=o._setSection(n,a,t[0],t[1])}})}return n},_judgeStatus:function(e,t,s,a,i,r){var n=a[0],h=a[1],o=a[2];switch(s){case"single":h=this._setPoint("=",h,Date.parse(i),Date.parse(r[e]));break;case"range":h=this._setPoint("=",h,Date.parse(i),Date.parse(r[e])),o=this._setSection(o,i,r[0],r[1]),0===e?n=this._setPoint(">",n,Date.parse(i),Date.parse(r[1])):1===e&&(n=this._setPoint("<",n,Date.parse(i),Date.parse(r[0])));break;case"multiple":for(var c=0;this.selectedDate.length>c;c++)Date.parse(i)===r[c]&&(h=!0)}return a=[n,h,o]},_renderStatus:function(e){var t=e[0],s=e[1],a=e[2],i=e[3],r="";return i===!0?r=" is-untouchable":(t===!0&&(r=" is-untouchable"),a===!0&&(r+=" is-inRange")),s===!0&&(r+=" is-active"),r},_buildDays:function(e){var t,s,i,r,n,h,o,c=this.currentYear[e],l=this.currentMonth[e],u=new Date(c,l+1,0).getDate(),p=new Date(c,l,1).getDay(),d=new Date(c,l,0).getDate(),D=p-this.options.firstDayOfWeek,f='<div class="'+this.namespace+'-week">',g=[],m=[];D=0>D?7+D:D;for(var w=0;7>w;w++)f+="<span>"+a[this.options.lang].daysShort[w]+"</span>";f+='</div><div class="'+this.namespace+'-day"><div class="'+this.namespace+'-row">';for(var y=0;42>y;y++)t=y-D+1,i=!1,r=!1,s=!1,n=!1,g=[s,i,r,n],h=0,o="",y>0&&0===y%7&&(f+='</div><div class="'+this.namespace+'-row">'),D>y?(o="is-otherMonth",h=d-D+y+1,m[y]=new Date(c,l-1,h,0,0,0,0)):y>u+D-1?(o="is-otherMonth",h=t-u,m[y]=new Date(c,l+1,h,0,0,0,0)):(m[y]=new Date(c,l,t,0,0,0,0),h=t,"multiple"===this.mode?Date.parse(m[y])===Date.parse(this.focusDate)&&(o+=" is-focus"):Date.parse(m[y])===Date.parse(this.focusDate[e])&&(o+=" is-focus")),g=this._judgeStatus(e,"days",this.mode,g,m[y],this.selectedDate),g[3]=this._judgeRange("days",g[3],m[y]),("section"===this.options.rangeMode&&this.daySelectable===!0||"array"===this.options.rangeMode&&this.selectableDate===!0)&&(g[3]=!g[3]),o+=this._renderStatus(g),f+='<span class="'+o+'">'+h+"</span>";return f+="</div></div>"},_buildMonths:function(e){var t,s,i,r,n,h=this.currentYear[e],o="",c=a[this.options.lang].monthsShort,l=this.focusDate[e],u=[],p=[];o+='<div class="'+this.namespace+'-row">';for(var d=0;12>d;d++)s=!1,i=!1,r=!1,n=!1,p=[r,s,i,n],t="",d>0&&0===d%3&&(o+='</div><div class="'+this.namespace+'-row">'),u[d]=new Date(h,d,1,0,0,0,0),p=this._judgeStatus(e,"months",this.mode,p,u[d],this.selectedMonthDate),p[3]=this._judgeRange("months",p[3],u[d]),("section"===this.options.rangeMode&&this.monthSelectable===!0||"array"===this.options.rangeMode&&this.selectableDate===!0)&&(p[3]=!p[3]),Date.parse(u[d])===Date.parse(new Date(l.getFullYear(),l.getMonth(),1,0,0,0,0))&&(t+=" is-focus"),t+=this._renderStatus(p),o+='<span class="month-'+d+" "+t+'">'+c[d]+"</span>";return o+="</div>"},_buildYears:function(e){var t,s,a,i,r,n=this.currentYear[e],h="",o=0,c=[],l=this.focusDate[e],u=[];h+='<div class="'+this.namespace+'-row">';for(var p=0;12>p;p++)s=!1,a=!1,i=!1,r=!1,u=[i,s,a,r],t="",o=n-7+p,p>0&&0===p%3&&(h+='</div><div class="'+this.namespace+'-row">'),c[p]=new Date(o,0,1,0,0,0,0),u=this._judgeStatus(e,"years",this.mode,u,c[p],this.selectedYearDate),u[3]=this._judgeRange("years",u[3],c[p]),("section"===this.options.rangeMode&&this.yearSelectable===!0||"array"===this.options.rangeMode&&this.selectableDate===!0)&&(u[3]=!u[3]),Date.parse(c[p])===Date.parse(new Date(l.getFullYear(),0,1,0,0,0,0))&&(t+=" is-focus"),t+=this._renderStatus(u),h+='<span class="'+t+'">'+o+"</span>";return h+="</div>"},_judgeLock:function(e){var t,s,a=!1,i=!1;switch(this.mode){case"range":if(0===e){switch(this.views[e]){case"days":t=Date.parse(this.currentDate[e]),s=Date.parse(this.selectedMonthDate[1]);break;case"months":t=Date.parse(this.currentYearDate[e]),s=Date.parse(this.selectedYearDate[1]);break;case"years":t=new Date(this.currentYearDate[e]).setFullYear(this.currentYear[e]+4),s=Date.parse(this.selectedYearDate[1])}i=!this._setPoint("<",i,t,s)}else{switch(this.views[e]){case"days":t=Date.parse(this.currentDate[e]),s=Date.parse(this.selectedMonthDate[0]);break;case"months":t=Date.parse(this.currentYearDate[e]),s=Date.parse(this.selectedYearDate[0]);break;case"years":t=new Date(this.currentYearDate[e]).setFullYear(this.currentYear[e]+4),s=Date.parse(this.selectedYearDate[0])}a=!this._setPoint(">",a,t,s)}break;case"multiple":0===e?i=!0:a=e===this.options.calendars-1?!0:i=!0}a===!0?this.calendarPrevs.eq(e).addClass(this.namespace+"-blocked"):this.calendarPrevs.eq(e).removeClass(this.namespace+"-blocked"),i===!0?this.calendarNexts.eq(e).addClass(this.namespace+"-blocked"):this.calendarNexts.eq(e).removeClass(this.namespace+"-blocked")},_generateDaypicker:function(e){this._generateHeader(e,a[this.options.lang].months[this.currentMonth[e]]+" "+this.currentYear[e]),this.daypickers.eq(e).html(this._buildDays(e))},_generateMonthpicker:function(e){this._generateHeader(e,this.currentYear[e]),this.monthpickers.eq(e).html(this._buildMonths(e))},_generateYearpicker:function(e){this._generateHeader(e,this.currentYear[e]-7+this.options.rangeSeparator+(this.currentYear[e]+4)),this.yearpickers.eq(e).html(this._buildYears(e))},_generateHeader:function(e,t){this.calendarCaptions.eq(e).html(t),this._judgeLock(e)},updateDate:function(e){this.currentDate[e].setDate(1),this.currentDate[e].setHours(0,0,0,0),this.currentDay[e]=this.currentDate[e].getDate(),this.currentMonth[e]=this.currentDate[e].getMonth(),this.currentYear[e]=this.currentDate[e].getFullYear(),this.currentMonthDate[e]=new Date(this.currentYear[e],this.currentMonth[e],1,0,0,0,0),this.currentYearDate[e]=new Date(this.currentYear[e],0,1,0,0,0,0),"multiple"!==this.mode&&(this.selectedDay[e]=this.selectedDate[e].getDate(),this.selectedMonth[e]=this.selectedDate[e].getMonth(),this.selectedYear[e]=this.selectedDate[e].getFullYear(),this.selectedMonthDate[e]=new Date(this.selectedYear[e],this.selectedMonth[e],1,0,0,0,0),this.selectedYearDate[e]=new Date(this.selectedYear[e],0,1,0,0,0,0))},manageViews:function(e){switch(this.views[e]){case"days":this._generateDaypicker(e),this.daypickers.eq(e).show(),this.monthpickers.eq(e).hide(),this.yearpickers.eq(e).hide();break;case"months":this._generateMonthpicker(e),this.daypickers.eq(e).hide(),this.monthpickers.eq(e).show(),this.yearpickers.eq(e).hide();break;case"years":this._generateYearpicker(e),this.daypickers.eq(e).hide(),this.monthpickers.eq(e).hide(),this.yearpickers.eq(e).show()}this.options.onRender&&this.options.onRender.apply(this)},position:function(){var e=(window.innerHeight,window.innerWidth,this.picker.outerHeight()),t=this.picker.outerWidth(),s=this.$el.offset().top,a=this.$el.offset().left,i=this.$el.outerHeight(),r=this.$el.outerWidth(),n=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,h=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,o=s-n,c=a-h;switch(this.options.position){case"top":this.picker.css({left:c+h,top:o-e+n});break;case"right":this.picker.css({left:c+r+h,top:o+n});break;case"bottom":this.picker.css({left:c+h,top:o+i+n});break;case"left":this.picker.css({left:c-t+h,top:o+n});break;case"rightTop":this.picker.css({left:c+r+h,top:o-e+i+n});break;case"leftTop":this.picker.css({left:c-t+h,top:o-e+i+n})}},show:function(){var e=this;return"inline"===this.options.displayMode?(this.options.onBeforeShow&&this.options.onBeforeShow.apply(this),this.picker.css("display","inline-block"),this.picker.on("click.picker",function(t){e.click.call(e,t)})):this.showed===!1&&(this.options.onBeforeShow&&this.options.onBeforeShow.apply(this),this.picker.css("display","inline-block"),this.position(),this.showed=!0,s.on("click."+this.flag,function(t){e.click.call(e,t)})),this.options.onShow&&this.options.onShow.apply(this),this},hide:function(){return this.showed===!0&&(this.options.onBeforeHide&&this.options.onBeforeHide.apply(this),this.selected=!1,this.picker.hide(),this.showed=!1,s.off("click."+this.flag),this.options.onHide&&this.options.onHide.apply(this)),this},prev:function(e,t){var s=this.currentDate[e];switch(this.views[e]){case"days":if("multiple"===this.mode){if(t)if(0===this.focused)for(var a=0;this.options.calendars>a;a++)this.currentDate[a].setMonth(this.currentMonth[a]-1),this.updateDate(a),this.manageViews(a);else--this.focused,this.manageViews(e),this.manageViews(e-1);else{var i=new Date(s.getFullYear(),s.getMonth(),0).getDate();this.focusDate.getDate()>i&&this.focusDate.setDate(i),this.focusDate.setMonth(this.focusDate.getMonth()-1);for(var r=0;this.options.calendars>r;r++)this.currentDate[r].setMonth(this.currentMonth[r]-1),this.updateDate(r),this.manageViews(r)}return!1}if(s.setMonth(this.currentMonth[e]-1),t){var i=new Date(s.getFullYear(),s.getMonth(),0).getDate();this.focusDate[e].getDate()>i&&this.focusDate[e].setDate(i),this.focusDate[e]=new Date(s.getFullYear(),s.getMonth(),this.focusDate[e].getDate(),0,0,0,0)}break;case"months":s.setYear(this.currentYear[e]-1),t&&(this.focusDate[e]=new Date(s.getFullYear(),this.focusDate[e].getMonth(),this.focusDate[e].getDate(),0,0,0,0));break;case"years":s.setYear(this.currentYear[e]-12)}this.updateDate(e),this.manageViews(e)},next:function(e,t){var s=this.currentDate[e];switch(this.views[e]){case"days":if("multiple"===this.mode){if(t)if(this.focused===this.options.calendars-1)for(var a=0;this.options.calendars>a;a++)this.currentDate[a].setMonth(this.currentMonth[a]+1),this.updateDate(a),this.manageViews(a);else++this.focused,this.manageViews(e),this.manageViews(e+1);else{var i=new Date(s.getFullYear(),s.getMonth()+2,0).getDate();this.focusDate.getDate()>i&&this.focusDate.setDate(i),this.focusDate.setMonth(this.focusDate.getMonth()+1);for(var r=0;this.options.calendars>r;r++)this.currentDate[r].setMonth(this.currentMonth[r]+1),this.updateDate(r),this.manageViews(r)}return!1}if(s.setMonth(this.currentMonth[e]+1),t){var i=new Date(s.getFullYear(),s.getMonth()+1,0).getDate();this.focusDate[e].getDate()>i&&this.focusDate[e].setDate(i),this.focusDate[e]=new Date(s.getFullYear(),s.getMonth(),this.focusDate[e].getDate(),0,0,0,0)}break;case"months":s.setYear(this.currentYear[e]+1),t&&(this.focusDate[e]=new Date(s.getFullYear(),this.focusDate[e].getMonth(),this.focusDate[e].getDate(),0,0,0,0));break;case"years":s.setYear(this.currentYear[e]+12)}this.updateDate(e),this.manageViews(e)},changeView:function(e,t){switch(e){case"caption":if("multiple"!==this.options.mode)if("days"===this.views[t])this.views[t]="months";else{if("months"!==this.views[t])return!1;this.views[t]="years"}break;case"content":if("years"===this.views[t])this.views[t]="months";else{if("months"!==this.views[t])return!1;this.views[t]="days"}break;case"higher":if("multiple"!==this.options.mode)if("days"===this.views[t])this.views[t]="months";else{if("months"!==this.views[t])return!1;this.views[t]="years"}break;case"lower":if("multiple"!==this.options.mode)if("years"===this.views[t])this.views[t]="months";else{if("months"!==this.views[t])return!1;this.views[t]="days"}}},changeValue:function(t,s){var a="",i="",r=this;switch(this.views[s]){case"years":a=parseInt(t.text(),10),this.currentDate[s].setYear(a);break;case"months":a=Number(t.attr("class").match(/month\-([0-9]+)/)[1]),this.currentDate[s].setMonth(a);break;case"days":switch(a=parseInt(t.text(),10),i=new Date(this.currentYear[s],this.currentMonth[s],a,0,0,0,0),this.options.mode){case"single":case"range":this.selectedDate[s]=i;break;case"multiple":var n=Date.parse(i);e.inArray(n,this.selectedDate)>-1?e.each(this.selectedDate,function(e,t){return t===n?(r.selectedDate.splice(e,1),!1):void 0}):this.selectedDate.push(n)}}},setValue:function(){switch(this.mode){case"single":var e=this._formatDate(this.selectedDate[0],this.outputFormat);this.$el.val(e);break;case"range":var t=this._formatDate(this.selectedDate[0],this.outputFormat),s=this._formatDate(this.selectedDate[1],this.outputFormat);this.$el.val(t+this.options.rangeSeparator+s);break;case"multiple":for(var e,a="",i=0;this.selectedDate.length>i;i++)e=this._formatDate(new Date(this.selectedDate[i]),this.outputFormat),a+=0===a.length?e:this.options.multipleSeparator+e;this.$el.val(a)}this.options.onChange&&this.options.onChange.apply(this),this.oldValue=this.$el.val()},multipleClear:function(){this.selectedDate=[];for(var e=0;this.options.calendars>e;e++)this.manageViews(e);this.setValue()},getWrap:function(){return this.picker},getInput:function(){return this.$el},getDate:function(e){if(void 0===e)return this.selectedDate;for(var t=this._parseFormat(e),s=[],a=0;this.selectedDate.length>a;a++)s[a]=this._formatDate(this.selectedDate[a],t);return s},destroy:function(){this.$el.removeData("datepicker"),this.getWrap().remove()},update:function(e){if(e!==void 0)for(var t in e)this.options[t]=e[t];this.destroy(),this._init()},click:function(t){if(0===e(t.target).closest(this.picker).length&&0===e(t.target).closest(this.$el).length&&this.options.alwaysShow===!1)this.hide();else if(1!==e(t.target).closest(this.$el).length&&1===e(t.target).closest(this.picker).length){var s=e(t.target).closest("span");if(1===s.length){var a=s.parents("."+this.namespace).index();switch(s[0].className){case this.namespace+"-caption":this.changeView("caption",a),this.manageViews(a);break;case this.namespace+"-prev":this.prev(a);break;case this.namespace+"-next":this.next(a);break;default:if(s.hasClass("is-otherMonth")||s.hasClass("is-untouchable")||1===s.parents(".calendar-week").length)return!1;this.changeValue(s,a),"days"===this.views[a]&&"single"===this.mode&&(this.selected=!0),this.changeView("content",a),this.updateDate(a),"range"===this.mode?(this.manageViews(0),this.manageViews(1)):"multiple"===this.mode?(this.manageViews(a-1),this.manageViews(a),this.manageViews(a+1)):"single"===this.mode&&this.manageViews(a),this.setValue()}}this.selected===!0&&this.options.alwaysShow===!1&&"single"===this.mode&&this.options.onceClick===!0?this.hide():"dropdown"===this.options.displayMode&&this.$el.focus()}},prevDate:function(e){var e=this.focused,t="multiple"===this.mode?this.focusDate:this.focusDate[e];switch(this.views[e]){case"days":t.setDate(t.getDate()-1),new Date(t).setDate(1)===new Date(this.currentMonthDate[e]).setMonth(this.currentDate[e].getMonth()-1)?this.prev(e,!0):this.manageViews(e);break;case"months":t.setMonth(t.getMonth()-1),Date.parse(new Date(t.getFullYear(),0,1,0,0,0,0))===new Date(this.currentYearDate[e]).setFullYear(this.currentDate[e].getFullYear()-1)?this.prev(e):this.manageViews(e);break;case"years":t.setFullYear(t.getFullYear()-1),t.getFullYear()===this.currentYear[e]-8?this.prev(e):this.manageViews(e)}},nextDate:function(){var e=this.focused,t="multiple"===this.mode?this.focusDate:this.focusDate[e];switch(this.views[e]){case"days":t.setDate(t.getDate()+1),new Date(t).setDate(1)===new Date(this.currentMonthDate[e]).setMonth(this.currentDate[e].getMonth()+1)?this.next(e,!0):this.manageViews(e);break;case"months":t.setMonth(t.getMonth()+1),Date.parse(new Date(t.getFullYear(),0,1,0,0,0,0))===new Date(this.currentYearDate[e]).setFullYear(this.currentDate[e].getFullYear()+1)?this.next(e):this.manageViews(e);break;case"years":t.setFullYear(t.getFullYear()+1),t.getFullYear()===this.currentYear[e]+5?this.next(e):this.manageViews(e)}},upLine:function(){var e=this.focused,t="multiple"===this.mode?this.focusDate:this.focusDate[e];switch(this.views[e]){case"days":t.setDate(t.getDate()-7),new Date(t).setDate(1)===new Date(this.currentMonthDate[e]).setMonth(this.currentDate[e].getMonth()-1)?this.prev(e,!0):this.manageViews(e);break;case"months":t.setMonth(t.getMonth()-3),Date.parse(new Date(t.getFullYear(),0,1,0,0,0,0))===new Date(this.currentYearDate[e]).setFullYear(this.currentDate[e].getFullYear()-1)?this.prev(e):this.manageViews(e);break;case"years":t.setFullYear(t.getFullYear()-3),t.getFullYear()<=this.currentYear[e]-8?this.prev(e):this.manageViews(e)}},downLine:function(){var e=this.focused,t="multiple"===this.mode?this.focusDate:this.focusDate[e];switch(this.views[e]){case"days":t.setDate(t.getDate()+7),new Date(t).setDate(1)===new Date(this.currentMonthDate[e]).setMonth(this.currentDate[e].getMonth()+1)?this.next(e,!0):this.manageViews(e);break;case"months":t.setMonth(t.getMonth()+3),Date.parse(new Date(t.getFullYear(),0,1,0,0,0,0))===new Date(this.currentYearDate[e]).setFullYear(this.currentDate[e].getFullYear()+1)?this.next(e):this.manageViews(e);break;case"years":t.setFullYear(t.getFullYear()+3),t.getFullYear()>=this.currentYear[e]+5?this.next(e):this.manageViews(e)}},prevPage:function(){if("multiple"===this.mode)this.prev(this.focused);else{if(this.calendarPrevs.eq(this.focused).hasClass(this.namespace+"-blocked"))return!1;this.prev(this.focused,!0)}},nextPage:function(){if("multiple"===this.mode)this.next(this.focused);else{if(this.calendarNexts.eq(this.focused).hasClass(this.namespace+"-blocked"))return!1;this.next(this.focused,!0)}},higherView:function(){if("multiple"===this.mode)return!1;var e=this.focused;this.changeView("higher",e),this.manageViews(e)},lowerView:function(){if("multiple"===this.mode)return!1;var e=this.focused;this.changeView("lower",e),this.manageViews(e)},prevCalendar:function(){if("multiple"===this.mode)return!1;var e=this.calendars.length;0>--this.focused&&(this.focused=e)},nextCalendar:function(){if("multiple"===this.mode)return!1;var e=this.calendars.length;++this.focused>=e&&(this.focused=0)},updateValue:function(){var t=this.focused,s="multiple"===this.mode?this.focusDate:this.focusDate[t];if(self=this,this.calendars.eq(t).find(".is-focus").hasClass("is-untouchable"))return!1;switch(this.views[t]){case"days":switch(this.options.mode){case"single":case"range":this.selectedDate[t]=new Date(s);break;case"multiple":var a=Date.parse(new Date(s));e.inArray(a,this.selectedDate)>-1?e.each(this.selectedDate,function(e,t){return t===a?(self.selectedDate.splice(e,1),!1):void 0}):this.selectedDate.push(a)}break;case"months":this.currentDate[t].setMonth(s.getMonth()),this.views[t]="days";break;case"years":this.currentDate[t].setFullYear(s.getFullYear()),this.views[t]="months"}this.updateDate(t),"range"===this.mode?(this.manageViews(0),this.manageViews(1)):"multiple"===this.mode?(this.manageViews(t-1),this.manageViews(t),this.manageViews(t+1)):this.manageViews(t),this.setValue()},enter:function(){var t,s=this.$el.val(),a=this;if(s===this.oldValue||""===this.oldValue)this.updateValue();else{var i;switch(this.mode){case"single":var r=Date.parse(s);r&&(this.selectedDate[0]=new Date(r),this.currentDate[0]=new Date(this.selectedDate[0]),this.updateDate(0),this.manageViews(0));break;case"range":i=this._stringSeparate(s,this.options.rangeSeparator);var n=Date.parse(i[0]),h=Date.parse(i[1]);if(2===i.length?(t=!0,n&&h?n>h&&(t=!1):t=!1):t=!1,t===!0){this.selectedDate[0]=new Date(n),this.selectedDate[1]=new Date(h);for(var o=0;2>o;o++)this.currentDate[o]=new Date(this.selectedDate[o]),this.updateDate(o),this.manageViews(o)}else this.updateValue();break;case"multiple":i=this._stringSeparate(s,this.options.multipleSeparator);var c=[];t=!0;for(var l=0;i.length>l;l++){var r=Date.parse(i[l]);c.push(r),Date.parse(i[l])||(t=!1)}if(t===!0){this.selectedDate=[];for(var u=0;c.length>u;u++)e.inArray(c[u],this.selectedDate)>-1?e.each(this.selectedDate,function(e,t){return t===c[u]?(a.selectedDate.splice(e,1),!1):void 0}):this.selectedDate.push(c[u]);for(var p=0;this.options.calendars>p;p++)this.updateDate(p),this.manageViews(p)}else this.updateValue()}}this.setValue()},esc:function(){this.$el.blur(),this.hide()},tab:function(){this.pickerHide=!0},keys:function(){return{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,ESC:27,CTRL:17,ALT:18}},gather:function(){return{left:e.proxy(this.prevDate,this),up:e.proxy(this.upLine,this),right:e.proxy(this.nextDate,this),down:e.proxy(this.downLine,this),ctrl_left:e.proxy(this.prevPage,this),ctrl_up:e.proxy(this.higherView,this),ctrl_right:e.proxy(this.nextPage,this),ctrl_down:e.proxy(this.lowerView,this),alt_left:e.proxy(this.prevCalendar,this),alt_right:e.proxy(this.nextCalendar,this),enter:e.proxy(this.enter,this),esc:e.proxy(this.esc,this)}},press:function(e){var t,s=e.keyCode||e.which;return e.ctrlKey?(e.preventDefault(),t=this.map[17]):e.altKey?(e.preventDefault(),t=this.map[18]):t=this.map,9===s&&this.tab.call(this),s in t&&"function"==typeof t[s]?(e.preventDefault(),t[s].call(this)):void 0},attach:function(e){var t,s=this;for(t in e)if(e.hasOwnProperty(t)){var a=[],i=this._stringSeparate(t,"_"),r=i.length;if(1===r)a[0]=i[0].toUpperCase(),this.map[this.keys()[a[0]]]=e[t];else for(var n=0;i.length>n;n++)a[n]=i[n].toUpperCase(),0===n?void 0===this.map[this.keys()[a[0]]]&&(this.map[this.keys()[a[0]]]={}):this.map[this.keys()[a[0]]][this.keys()[a[n]]]=e[t]}this.bound||(this.bound=!0,"dropdown"===this.options.displayMode?this.$el.on("keydown.dropdown",function(e){s.press.call(s,e)}):this.picker.on("keydown.inline",function(e){s.press.call(s,e)}))},focus:function(){"dropdown"===this.options.displayMode&&this.showed===!1&&this.show(),this.attach(this.gather())},blur:function(){return this.bound=!1,"dropdown"===this.options.displayMode&&this.pickerHide===!0?(this.$el.off("keydown.dropdown"),this.hide(),this.pickerHide=!1):this.picker.off("keydown.inline"),!1}},e.fn.datepicker=function(s){if("string"!=typeof s)return this.each(function(){e.data(this,"datepicker")||e.data(this,"datepicker",new t(this,s))});var a=s,i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;if(!/^(getWrap|getInput|getDate)$/.test(a))return this.each(function(){var t=e.data(this,"datepicker");t&&"function"==typeof t[a]&&t[a].apply(t,i)});var r=this.first().data("datepicker");return r&&"function"==typeof r[a]?r[a].apply(r,i):void 0}})(jQuery);