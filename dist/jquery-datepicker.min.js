/*! Datepicker - v0.1.0 - 2013-05-20
* https://github.com/amazingsurge/jquery-datepicker
* Copyright (c) 2013 amazingSurge; Licensed MIT */
(function(e){var t=e.daypicker=function(s,a){this.el=e(s),this.options=e.extend(!0,{},t.defaults,a),this.format=this.parse_format(this.options.format||"mm/dd/yyyy"),this.namespace=this.options.namespace,this.init()},s={};t.defaults={first_day_of_week:1,mode:"single",calendars:2,date:"today",max:null,min:null,position:"bottom",alwaysShow:!1,selectableYear:[],selectableMonth:[],selectableDay:[],selectableDate:[],disabledYear:[],disabledMonth:[],disabledDay:[],disabledDate:[],lang:"en",views:["days"],format:"yyyy/mm/dd",namespace:"calendar",tpl_wrapper:'<div class="namespace-wrap"></div>',tpl_content:'<div class="namespace"><div class="namespace-head"><span class="namespace-prev"></span><span class="namespace-caption"></span><span class="namespace-next"></span></div><table class="namespace-days"></table><table class="namespace-months"></table><table class="namespace-years"></table></div>',localize:function(e,t){s[e]=t},onRender:function(){},onChange:function(){},onBeforeShow:function(){},onShow:function(){},onBeforeHide:function(){},onHide:function(){}},t.defaults.localize("en",{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_short:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),t.defaults.localize("zh",{days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],days_short:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],months_short:["一","二","三","四","五","六","七","八","九","十","十一","十二"]}),t.prototype={constructor:t,_parse_able_date:function(e,t){for(var s=this.parse_format(t),a=(this.default_date.getDate(),[]),i=0,r=0;e.length>r;r++)if("string"==typeof e[r]&&(a[i]=e[r],i++),"object"==typeof e[r]){var n,h,o=e[r];for(var c in o)switch(c){case"from":n=o[c];break;case"to":h=o[c]}a[i]=[this.parse_date(n,s),this.parse_date(h,s)],i++}return a},_parse_able:function(e){for(var t=[],s=0,a=0;e.length>a;a++)if("number"==typeof e[a]&&(t[s]=e[a],s++),"object"==typeof e[a]){var i,r,n=e[a];for(var h in n)switch(h){case"from":i=n[h];break;case"to":r=n[h]}for(var o=i;r>=o;o++)t[s]=o,s++}return t},init:function(){var t=this.options.tpl_wrapper.replace(/namespace/g,this.namespace),s=this.options.tpl_content.replace(/namespace/g,this.namespace),a="";if(this.picker=e(t).appendTo("body").on({click:e.proxy(this.click,this)}),"today"!==this.options.date){var i=this.parse_date(this.options.date,this.parse_format("yyyy-mm-dd"));this.default_date=i}else this.default_date=new Date;if(this.selected_date="today"===this.options.date?[new Date]:[new Date(i)],this.current_date="today"===this.options.date?[new Date]:[new Date(i)],"single"===this.options.mode)a+=s,this.current_date[0].setHours(0,0,0,0),this.selected_date[0].setHours(0,0,0,0);else{"range"===this.options.mode?this.options.calendars=2:"multiple"===this.options.mode&&(this.multiple_date=[]);for(var r=0;this.options.calendars>r;r++)a+=s,void 0===this.options.views[r]&&(this.options.views[r]="days"),void 0===this.current_date[r]&&(this.current_date[r]="today"===this.options.date?new Date:new Date(i)),void 0===this.selected_date[r]&&(this.selected_date[r]="today"===this.options.date?new Date:new Date(i)),this.current_date[r].setHours(0,0,0,0),this.selected_date[r].setHours(0,0,0,0)}if(this.picker.append(a),this.view=this.options.views,this.calendar=this.picker.find("."+this.namespace),this.calendar_prev=this.calendar.find("."+this.namespace+"-prev"),this.calendar_caption=this.calendar.find("."+this.namespace+"-caption"),this.calendar_next=this.calendar.find("."+this.namespace+"-next"),this.daypicker=this.calendar.find("."+this.namespace+"-days"),this.monthpicker=this.calendar.find("."+this.namespace+"-months"),this.yearpicker=this.calendar.find("."+this.namespace+"-years"),null!==this.options.min&&(this.min_year=this.getMin().getFullYear(),this.min_month=this.getMin().getMonth()),null!==this.options.max&&(this.max_year=this.getMax().getFullYear(),this.max_month=this.getMax().getMonth()),this.update_date(),"multiple"===this.options.mode){for(var r=0;this.options.calendars>r;r++)this.set_date(this.current_date[r],"month",this.current_month[r]+r);this.update_date()}if("single"===this.options.mode)this.manage_views(0);else for(var r=0;this.options.calendars>r;r++)this.manage_views(r);this.is_input=this.el.is("input"),this.is_input?this.options.alwaysShow===!1?this.el.on({focus:e.proxy(this.show,this)}):this.show():this.el="",this.set_value()},update:function(e){if(e!==void 0)for(var t in e)this.options[t]=e[t];this.destroy(),this.init()},show:function(){var t=this;this.options.alwaysShow!==!0?(this.options.onBeforeShow&&this.options.onBeforeShow.apply(this),this.picker.show(),this.options.onShow&&this.options.onShow.apply(this)):this.picker.show(),this.position(),this.options.alwaysShow!==!0&&e(document).on("mousedown",function(s){0===e(s.target).closest(t.calendar).length&&0===e(s.target).closest(t.el).length&&t.hide()})},hide:function(){this.options.onBeforeHide&&this.options.onBeforeHide.apply(this),this.picker.hide(),this.options.onHide&&this.options.onHide.apply(this)},multipleClear:function(){this.multiple_date=[];for(var e=0;this.options.calendars>e;e++)this.manage_views(e);this.set_value()},getWrap:function(){return this.picker},getInput:function(){return this.el},getDate:function(e){if(void 0===e){if("multiple"===this.options.mode){for(var t=[],s=0;this.multiple_date.length>s;s++)t[s]=new Date(this.multiple_date[s]);return t}return this.selected_date}var a=this.parse_format(e),i=[];if("multiple"===this.options.mode)for(var s=0;this.multiple_date.length>s;s++)i[s]=this.format_date(new Date(this.multiple_date[s]),a);else for(var s=0;this.selected_date.length>s;s++)i[s]=this.format_date(this.selected_date[s],a);return i},getMax:function(){var e,t=this.el.attr("max")||this.options.max,s=this.default_date.getDate(),a=this.parse_format("yyyy-mm-dd");if(t){if("number"==typeof t)e=new Date(this.default_date),e.setDate(s+t);else{if("string"==typeof t){var i=t.match(/[.\/\-\s].*?/);3!==t.split(i).length&&(t=parseInt(t))}e=this.parse_date(t,a)}return e}return!1},getMin:function(){var e,t=this.el.attr("min")||this.options.min,s=this.default_date.getDate(),a=this.parse_format("yyyy-mm-dd");if(t){if("number"==typeof t)e=new Date(this.default_date),e.setDate(s-t);else{if("string"==typeof t){var i=t.match(/[.\/\-\s].*?/);3!==t.split(i).length&&(t=parseInt(t))}e=this.parse_date(t,a)}return e}return!1},destroy:function(){this.el.removeData("datepicker"),this.getWrap().remove()},position:function(){var e=(window.innerHeight,window.innerWidth,this.picker.outerHeight()),t=this.picker.outerWidth(),s=this.el.offset().top,a=this.el.offset().left,i=this.el.outerHeight(),r=this.el.outerWidth(),n=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,h=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,o=s-n,c=a-h;switch(this.options.position){case"top":this.picker.css({left:c+h,top:o-e+n});break;case"right":this.picker.css({left:c+r+h,top:o+n});break;case"bottom":this.picker.css({left:c+h,top:o+i+n});break;case"left":this.picker.css({left:c-t+h,top:o+n});break;case"rightTop":this.picker.css({left:c+r+h,top:o-e+i+n});break;case"leftTop":this.picker.css({left:c-t+h,top:o-e+i+n})}},set_value:function(){switch(this.options.mode){case"single":var e=this.format_date(this.selected_date[0],this.format);this.el.val(e);break;case"range":var t=this.format_date(this.selected_date[0],this.format),s=this.format_date(this.selected_date[1],this.format);this.el.val(t+" - "+s);break;case"multiple":for(var e,a="",i=0;this.multiple_date.length>i;i++)e=this.format_date(new Date(this.multiple_date[i]),this.format),a+=0===a.length?e:","+e;this.el.val(a)}},set_date:function(e,t,s){if("object"==typeof t)for(var a in t)switch(a){case"day":e.setDate(t[a]);break;case"month":e.setMonth(t[a]);break;case"year":e.setYear(t[a])}else switch(t){case"day":e.setDate(s);break;case"month":e.setMonth(s);break;case"year":e.setYear(s)}},str_pad:function(e,t){for(e+="";t>e.length;)e="0"+e;return e},str_concat:function(){for(var e="",t=0;arguments.length>t;t++)e+=arguments[t]+"";return e},parse_format:function(e){var t=e.match(/[.\/\-\s].*?/),s=e.split(/\W+/)||s;if(!s||0===s.length)throw Error("Invalid date format.");return{separator:t,parts:s}},parse_date:function(e,t){switch(typeof e){case"string":var s,a=e.split(t.separator)||a,i=new Date;if(i.setHours(0,0,0,0),a.length===t.parts.length)for(var r=0,n=t.parts.length;n>r;r++){if(s=parseInt(a[r],10)||1,"1"===s)return;switch(t.parts[r]){case"dd":case"d":i.setDate(s);break;case"mm":case"m":i.setMonth(s-1);break;case"yy":i.setFullYear(2e3+s);break;case"yyyy":i.setFullYear(s)}}break;case"number":var i=new Date(this.default_date),h=i.getDate();i.setHours(0,0,0,0),i.setDate(h+e)}return i},format_date:function(e,t){var s={d:e.getDate(),m:e.getMonth()+1,yy:(""+e.getFullYear()).substring(2),yyyy:e.getFullYear()};s.dd=(10>s.d?"0":"")+s.d,s.mm=(10>s.m?"0":"")+s.m,e=[];for(var a=0,i=t.parts.length;i>a;a++)e.push(s[t.parts[a]]);return e.join(t.separator)},update_date:function(){if("single"===this.options.mode)this.current_day=[this.current_date[0].getDate()],this.current_month=[this.current_date[0].getMonth()],this.current_year=[this.current_date[0].getFullYear()],this.selected_day=[this.selected_date[0].getDate()],this.selected_month=[this.selected_date[0].getMonth()],this.selected_year=[this.selected_date[0].getFullYear()];else{this.current_day=[],this.current_month=[],this.current_year=[],this.selected_day=[],this.selected_month=[],this.selected_year=[];for(var e=0;this.options.calendars>e;e++)this.current_day[e]=this.current_date[e].getDate(),this.current_month[e]=this.current_date[e].getMonth(),this.current_year[e]=this.current_date[e].getFullYear(),this.selected_day[e]=this.selected_date[e].getDate(),this.selected_month[e]=this.selected_date[e].getMonth(),this.selected_year[e]=this.selected_date[e].getFullYear()}},judge_status:function(t,s,a){switch(t){case"days":0!==this.options.selectableDay.length&&-1===e.inArray(s.getDay(),this._parse_able(this.options.selectableDay))&&(a+=" is-untouchable"),0!==this.options.disabledDay.length&&-1!==e.inArray(s.getDay(),this._parse_able(this.options.disabledDay))&&(a+=" is-untouchable"),null!==this.options.min&&Date.parse(this.getMin())>Date.parse(s)&&(a+=" is-untouchable"),null!==this.options.max&&Date.parse(this.getMax())<Date.parse(s)&&(a+=" is-untouchable");break;case"months":0!==this.options.selectableMonth.length&&-1===e.inArray(s.getMonth(),this._parse_able(this.options.selectableMonth))&&(a+=" is-untouchable"),0!==this.options.disabledMonth.length&&-1!==e.inArray(s.getMonth(),this._parse_able(this.options.disabledMonth))&&(a+=" is-untouchable"),null!==this.options.min&&Date.parse(new Date(this.min_year,this.min_month,1,0,0,0,0))>Date.parse(date_array[i])&&(class_name+=" is-untouchable"),null!==this.options.max&&Date.parse(new Date(this.max_year,this.max_month,1,0,0,0,0))<Date.parse(date_array[i])&&(class_name+=" is-untouchable");break;case"years":0!==this.options.selectableYear.length&&-1===e.inArray(s,this._parse_able(this.options.selectableYear))&&(a+=" is-untouchable"),0!==this.options.disabledYear.length&&-1!==e.inArray(s,this._parse_able(this.options.disabledYear))&&(a+=" is-untouchable"),null!==this.options.min&&this.min_year>year&&(class_name="is-untouchable"),null!==this.options.max&&year>this.max_year&&(class_name="is-untouchable")}if(0!==this.options.selectableDate.length){for(var r,n,h,o=this._parse_able_date(this.options.selectableDate,"yyyy-mm-dd"),c=this.parse_format("yyyy-mm-dd"),l=!1,d=0;o.length>d;d++)switch(typeof o[d]){case"string":switch(t){case"days":r=new Date(this.parse_date(o[d],c));break;case"months":r=new Date(this.parse_date(o[d],c)),r.setDate(0);break;case"years":r=new Date(this.parse_date(o[d],c)).getFullYear()}Date.parse(s)===Date.parse(r)&&(l=!0);break;case"object":switch(n=o[d][0],h=o[d][1],t){case"days":n=new Date(o[d][0]),h=new Date(o[d][1]);break;case"months":n=new Date(o[d][0]),h=new Date(o[d][1]),n.setDate(0),h.setDate(0);break;case"years":n=new Date(o[d][0]).getFullYear(),h=new Date(o[d][1]).getFullYear()}Date.parse(s)>=Date.parse(n)&&Date.parse(s)<=Date.parse(h)&&(l=!0)}l===!1&&(a+=" is-untouchable")}if(0!==this.options.disabledDate.length){for(var r,n,h,o=this._parse_able_date(this.options.disabledDate,"yyyy-mm-dd"),l=!0,d=0;o.length>d;d++)switch(typeof o[d]){case"string":switch(t){case"days":r=new Date(this.parse_date(o[d],c));break;case"months":r=new Date(this.parse_date(o[d],c)),r.setDate(0);break;case"years":r=new Date(this.parse_date(o[d],c)).getFullYear()}Date.parse(s)===Date.parse(r)&&(l=!1);break;case"object":switch(n=o[d][0],h=o[d][1],t){case"days":n=new Date(o[d][0]),h=new Date(o[d][1]);break;case"months":n=new Date(o[d][0]),h=new Date(o[d][1]),n.setDate(0),h.setDate(0);break;case"years":n=new Date(o[d][0]).getFullYear(),h=new Date(o[d][1]).getFullYear()}Date.parse(s)>=Date.parse(n)&&Date.parse(s)<=Date.parse(h)&&(l=!1)}l===!1&&(a+=" is-untouchable")}return a},generate_daypicker:function(e){var t=new Date(this.current_year[e],this.current_month[e]+1,0).getDate(),a=new Date(this.current_year[e],this.current_month[e],2).getDay(),i=new Date(this.current_year[e],this.current_month[e],0).getDate(),r=a-this.options.first_day_of_week,n='<thead><tr class="'+this.namespace+'-week">';switch(this.options.mode){case"single":var h=this.current_year[0],o=this.current_month[0];null!==this.options.max&&(h>this.max_year?this.calendar_next.addClass(this.namespace+"-blocked"):this.max_year>h?this.calendar_next.removeClass(this.namespace+"-blocked"):o>=this.max_month?this.calendar_next.addClass(this.namespace+"-blocked"):this.calendar_next.removeClass(this.namespace+"-blocked")),null!==this.options.min&&(this.min_year>h?this.calendar_prev.addClass(this.namespace+"-blocked"):h>this.min_year?this.calendar_prev.removeClass(this.namespace+"-blocked"):this.min_month>=o?this.calendar_prev.addClass(this.namespace+"-blocked"):this.calendar_prev.removeClass(this.namespace+"-blocked"));break;case"range":var c=(this.current_date[0],this.current_date[1],this.selected_date[0]),l=this.selected_date[1],d=[];e>0?(this.current_year[e]===this.selected_year[e-1]?this.current_month[e]<=this.selected_month[e-1]?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).hasClass(this.namespace+"-blocked")===!0&&this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).hasClass(this.namespace+"-blocked")===!0&&this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked"),null!==this.options.max&&(this.current_year[e]>this.max_year?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.current_year[e]<this.max_year?this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"):this.current_month[e]>=this.max_month?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"))):(this.current_year[e]===this.selected_year[e+1]?this.current_month[e]>=this.selected_month[e+1]?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).hasClass(this.namespace+"-blocked")===!0&&this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"):this.calendar_next.eq(e).hasClass(this.namespace+"-blocked")===!0&&this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"),null!==this.options.min&&(this.current_year[e]<this.min_year?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.current_year[e]>this.min_year?this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked"):this.current_month[e]<=this.min_month?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked")));break;case"multiple":if(this.calendar_caption.eq(e).addClass(this.namespace+"-blocked"),0===e){var p=this.options.calendars-1;this.calendar_next.eq(e).addClass(this.namespace+"-blocked"),null!==this.options.min&&(this.current_year[e]===this.min_year?this.current_month[e]<=this.min_month?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked"):this.current_year[e]<this.min_year?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked"))}else e===this.options.calendars-1?(this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"),null!==this.options.max&&(this.current_year[e]===this.max_year?this.current_month[e]>=this.max_month?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"):this.current_year[e]>this.max_year?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"))):(this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"),this.calendar_next.eq(e).addClass(this.namespace+"-blocked"))}r=0>r?7+r:r,this.manage_header(s[this.options.lang].months[this.current_month[e]]+" "+this.current_year[e],e);for(var p=0;7>p;p++)n+="<th>"+s[this.options.lang].days_short[p]+"</th>";for(n+="</tr></thead>",n+="<tbody><tr>",p=0;42>p;p++){var _=p-r+1;switch(p>0&&0===p%7&&(n+="</tr><tr>"),this.options.mode){case"single":var u="";content=0,d=[],r>p?(d[p]=new Date(this.current_year[e],this.current_month[e]-1,i-r+p+1,0,0,0,0),u="otherMonthDay",content=i-r+p+1):p>t+r-1?(d[p]=new Date(this.current_year[e],this.current_month[e]+1,_-t,0,0,0,0),u="otherMonthDay",content=_-t):(d[p]=new Date(this.current_year[e],this.current_month[e],_,0,0,0,0),Date.parse(d[p])==Date.parse(this.selected_date[0])&&(u="is-active"),content=_),u=this.judge_status(this.view[e],d[p],u);break;case"range":var u="";content=0,d=[],r>p?(d[p]=new Date(this.current_year[e],this.current_month[e]-1,i-r+p+1,0,0,0,0),u="otherMonthDay",0===e?Date.parse(d[p])==Date.parse(c)?u+=" is-active":d[p]>c&&l>=d[p]&&(u+=" in-range"):1===e&&(Date.parse(d[p])==Date.parse(l)?u+=" is-active":d[p]>=c&&l>d[p]?u+=" in-range":c>d[p]&&(u+=" is-untouchable")),u=this.judge_status(this.view[e],d[p],u),content=i-r+p+1):p>t+r-1?(d[p]=new Date(this.current_year[e],this.current_month[e]+1,_-t,0,0,0,0),u="otherMonthDay",0===e?Date.parse(d[p])==Date.parse(c)?u+=" is-active":d[p]>c&&l>=d[p]?u+=" in-range":d[p]>l&&(u+=" is-untouchable"):1===e&&(Date.parse(d[p])==Date.parse(l)?u+=" is-active":d[p]>=c&&l>d[p]&&(u+=" in-range")),u=this.judge_status(this.view[e],d[p],u),content=_-t):(d[p]=new Date(this.current_year[e],this.current_month[e],_,0,0,0,0),0===e?Date.parse(d[p])==Date.parse(c)?u="is-active":d[p]>c&&l>=d[p]?u="in-range":d[p]>l&&(u="is-untouchable"):1===e&&(Date.parse(d[p])==Date.parse(l)?u="is-active":d[p]>=c&&l>d[p]?u="in-range":c>d[p]&&(u="is-untouchable")),u=this.judge_status(this.view[e],d[p],u),content=_);break;case"multiple":var u="";content=0,d=[],r>p?(d[p]=new Date(this.current_year[e],this.current_month[e]-1,i-r+p+1,0,0,0,0),u+=" otherMonthDay",content=i-r+p+1):p>t+r-1?(d[p]=new Date(this.current_year[e],this.current_month[e]+1,_-t,0,0,0,0),u+=" otherMonthDay",content=_-t):(d[p]=new Date(this.current_year[e],this.current_month[e],_,0,0,0,0),content=_);for(var m=0;this.multiple_date.length>m;m++)this.multiple_date[m]===Date.parse(d[p])&&(u+=" is-active");u=this.judge_status(this.view[e],d[p],u)}n+='<td class="'+u+'">'+content+"</td>"}n+="</tr>",this.daypicker.eq(e).html(n)},generate_monthpicker:function(e){this.manage_header(this.current_year[e],e);var t=s[this.options.lang].months_short;switch(this.options.mode){case"single":var a=[];null!==this.options.max&&(this.current_year[0]>=this.max_year?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).removeClass(this.namespace+"-blocked")),null!==this.options.min&&(this.current_year[0]<=this.min_year?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked"));break;case"range":var i=(new Date(this.current_year[0],this.current_month[0],1,0,0,0,0),new Date(this.current_year[1],this.current_month[1],1,0,0,0,0),new Date(this.selected_year[0],this.selected_month[0],1,0,0,0,0)),r=new Date(this.selected_year[1],this.selected_month[1],1,0,0,0,0),a=[];e>0?(this.current_year[e]<=this.selected_year[e-1]?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked"),null!==this.options.max&&(this.current_year[e]>=this.max_year?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"))):(this.current_year[e]===this.selected_year[e+1]?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).hasClass(this.namespace+"-blocked")===!0&&this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"),null!==this.options.min&&(this.current_year[e]<=this.min_year?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked")))}for(var n="<tr>",h=0;12>h;h++){switch(h>0&&0===h%3&&(n+="</tr><tr>"),this.options.mode){case"single":var o="month-"+h;a[h]=new Date(this.current_year[e],h,1,0,0,0,0),Date.parse(a[h])===Date.parse(new Date(this.selected_year[0],this.selected_month[0],1,0,0,0,0))&&(o+=" is-active"),o=this.judge_status(this.view[e],a[h],o);break;case"range":var o="month-"+h;a[h]=new Date(this.current_year[e],h,1,0,0,0,0),e>0?Date.parse(a[h])===Date.parse(r)?o+=" is-active":i>a[h]?o+=" is-untouchable":r>a[h]&&a[h]>=i&&(o+=" in-range"):Date.parse(a[h])===Date.parse(i)?o+=" is-active":a[h]>r?o+=" is-untouchable":r>=a[h]&&a[h]>i&&(o+=" in-range"),o=this.judge_status(this.view[e],a[h],o)}n+='<td class="'+o+'">'+t[h]+"</td>"}n+="</tr>",this.monthpicker.eq(e).html(n)},generate_yearpicker:function(e){switch(this.manage_header(this.current_year[e]-7+" - "+(this.current_year[e]+4),e),this.options.mode){case"single":null!==this.options.min&&(this.current_year[0]-7<this.min_year?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked")),null!==this.options.max&&(this.current_year[0]+4>this.max_year?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"));break;case"range":var t=(this.current_date[0].getFullYear(),this.current_date[1].getFullYear(),this.selected_date[0].getFullYear()),s=this.selected_date[1].getFullYear();e>0?(this.current_year[e]-7<=this.selected_year[e-1]?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked"),null!==this.options.max&&(this.current_year[e]+4>=this.max_year?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"))):(this.current_year[e]+4>=this.selected_year[e+1]?this.calendar_next.eq(e).addClass(this.namespace+"-blocked"):this.calendar_next.eq(e).removeClass(this.namespace+"-blocked"),null!==this.options.min&&(this.current_year[e]-7<=this.min_year?this.calendar_prev.eq(e).addClass(this.namespace+"-blocked"):this.calendar_prev.eq(e).removeClass(this.namespace+"-blocked")))}for(var a="<tr>",i=0;12>i;i++){var r=this.current_year[e]-7+i;switch(i>0&&0===i%3&&(a+="</tr><tr>"),this.options.mode){case"single":var n="";r===this.selected_year[e]?n="is-active":(n="",n=this.judge_status(this.view[e],r,n));break;case"range":var n="";e>0?r===s?n="is-active":t>r?n="is-untouchable":s>r&&r>=t&&(n="in-range"):r===t?n="is-active":r>s?n="is-untouchable":s>=r&&r>t&&(n="in-range"),n=this.judge_status(this.view[e],r,n)}a+='<td class="'+n+'">'+r+"</td>"}a+="</tr>",this.yearpicker.eq(e).html(a)},manage_header:function(e,t){this.calendar.eq(t).find("."+this.namespace+"-caption").html(e)},manage_views:function(e){switch(this.view[e]){case"days":this.generate_daypicker(e),this.daypicker.eq(e).css("display","block"),this.monthpicker.eq(e).hide(),this.yearpicker.eq(e).hide();break;case"months":this.generate_monthpicker(e),this.daypicker.eq(e).hide(),this.monthpicker.eq(e).css("display","block"),this.yearpicker.eq(e).hide();break;case"years":this.generate_yearpicker(e),this.daypicker.eq(e).hide(),this.monthpicker.eq(e).hide(),this.yearpicker.eq(e).css("display","block")}this.options.onRender&&this.options.onRender.apply(this)},prev:function(t){if(e(this).hasClass(this.namespace+"-blocked"))return!1;if("multiple"!==this.options.mode)"days"===this.view[t]?(0>--this.current_month[t]&&(this.current_month[t]=11,this.current_year[t]--),this.set_date(this.current_date[t],"month",this.current_month[t]),this.set_date(this.current_date[t],"year",this.current_year[t])):"months"===this.view[t]?(this.current_year[t]--,this.set_date(this.current_date[t],"year",this.current_year[t])):"years"===this.view[t]&&(this.current_year[t]-=12,this.set_date(this.current_date[t],"year",this.current_year[t])),this.update_date(),this.manage_views(t);else for(var s=0;this.options.calendars>s;s++){if("days"!==this.view[s])return!1;0>--this.current_month[s]&&(this.current_month[s]=11,this.current_year[s]--),this.set_date(this.current_date[s],"month",this.current_month[s]),this.set_date(this.current_date[s],"year",this.current_year[s]),this.update_date(),this.manage_views(s)}},next:function(t){if(e(this).hasClass(this.namespace+"-blocked"))return!1;if("multiple"!==this.options.mode)"days"===this.view[t]?(12===++this.current_month[t]&&(this.current_month[t]=0,this.current_year[t]++),this.set_date(this.current_date[t],"month",this.current_month[t]),this.set_date(this.current_date[t],"year",this.current_year[t])):"months"===this.view[t]?(this.current_year[t]++,this.set_date(this.current_date[t],"year",this.current_year[t])):"years"===this.view[t]&&(this.current_year[t]+=12,this.set_date(this.current_date[t],"year",this.current_year[t])),this.update_date(),this.manage_views(t);else for(var s=0;this.options.calendars>s;s++){if("days"!==this.view[s])return!1;12===++this.current_month[s]&&(this.current_month[s]=0,this.current_year[s]++),this.set_date(this.current_date[s],"month",this.current_month[s]),this.set_date(this.current_date[s],"year",this.current_year[s]),this.update_date(),this.manage_views(s)}},caption:function(e){if("multiple"===this.options.mode)return!1;if("days"===this.view[e])this.view[e]="months";else{if("months"!==this.view[e])return!1;this.view[e]="years"}this.update_date(),this.manage_views(e)},click:function(t){var s=e(t.target).closest("td, span"),a=function(t,s){var a;return e.each(t,function(e,t){t===s&&(a=e)}),a};if(1===s.length){var i=s.parents(".calendar"),r=a(this.calendar,i.get(0));switch(s[0].nodeName.toLowerCase()){case"span":switch(s[0].className){case this.namespace+"-caption":this.caption(r);break;case this.namespace+"-prev":this.prev(r);break;case this.namespace+"-next":this.next(r)}break;case"td":var n=s.parents("table").attr("class"),h=s.hasClass("otherMonthDay"),o=s.hasClass("is-untouchable"),c=this;switch(n){case this.namespace+"-days":if(h!==!1||o!==!1)return!1;var l=parseInt(s.text(),10);if(this.set_date(this.selected_date[r],{day:l,month:this.current_month[r],year:this.current_year[r]}),this.set_date(this.current_date[r],{day:l,month:this.current_month[r],year:this.current_year[r]}),this.update_date(),"range"===this.options.mode)0===r?(this.current_date[0]>this.current_date[1]&&(this.set_date(this.current_date[r+1],{month:this.current_month[r],year:this.current_year[r]}),this.update_date()),this.manage_views(r+1)):1===r&&(this.current_date[0]>this.current_date[1]&&(this.set_date(this.current_date[r-1],{month:this.current_month[r],year:this.current_year[r]}),this.update_date()),this.manage_views(r-1));else if("multiple"===this.options.mode){var d=Date.parse(new Date(this.current_date[r]));e.inArray(d,this.multiple_date)>-1?e.each(this.multiple_date,function(e,t){return t===d?(c.multiple_date.splice(e,1),!1):void 0}):this.multiple_date.push(d),this.manage_views(r-1),this.manage_views(r+1)}this.manage_views(r),this.set_value(r),this.options.onChange&&("multiple"!==this.options.mode&&"is-active"!==s.attr("class")?this.options.onChange.apply(this):"multiple"===this.options.mode&&this.options.onChange.apply(this)),"single"===this.options.mode&&this.options.alwaysShow===!1&&this.hide();break;case this.namespace+"-months":if(h!==!1||o!==!1)return!1;this.view[r]="days";var p=s.attr("class").match(/month\-([0-9]+)/),_=Number(p[1]);this.set_date(this.current_date[r],"month",_),this.update_date(),this.manage_views(r);break;case this.namespace+"-years":if(h!==!1||o!==!1)return!1;this.view[r]="months";var u=parseInt(s.text(),10);this.set_date(this.current_date[r],"year",u),this.update_date(),this.manage_views(r)}}}}},e.fn.datepicker=function(s){if("string"!=typeof s)return this.each(function(){e.data(this,"datepicker")||e.data(this,"datepicker",new t(this,s))});var a=s,i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;if(!/^(getWrap|getInput|getDate)$/.test(a))return this.each(function(){var t=e.data(this,"datepicker");t&&"function"==typeof t[a]&&t[a].apply(t,i)});var r=this.first().data("datepicker");return r&&"function"==typeof r[a]?r[a].apply(r,i):void 0}})(jQuery);