/*! Datepicker - v0.1.0 - 2013-04-23
* https://github.com/amazingsurge/jquery-datepicker
* Copyright (c) 2013 amazingSurge; Licensed MIT */
(function(t){var e=t.daypicker=function(s,a){var i=this;i.el=t(s),i.el,i.options=t.extend(!0,{},e.defaults,a);var a=i.options;i.format=i.parse_format(a.format||e.defaults.format||"mm/dd/yyyy"),i.init()};e.defaults={first_day_of_week:1,days:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],calendars:2,date:[new Date,new Date],mode:"range",views:["days","months"],format:"yyyy/mm/dd",tpl_wrapper:'<div class="calendar-wrap"></div>',tpl_content:'<div class="calendar"><table><thead><tr class="calendar-head"><th class="calendar-prev"></th><th class="calendar-caption"></th><th class="calendar-next"></th></tr></thead></table><table class="calendar-days"></table><table class="calendar-months"></table><table class="calendar-years"></table></div>'},e.prototype={constructor:e,init:function(){this.picker=t(e.defaults.tpl_wrapper).appendTo("body").on({click:t.proxy(this.click,this)}),this.picker.css("width",205*e.defaults.calendars+"px"),this.is_input=this.el.is("input"),this.is_input?(this._input=this.el,this.el.on({focus:t.proxy(this.show,this)})):this._input="",this.html="";for(var s=0;e.defaults.calendars>s;s++)this.html+=e.defaults.tpl_content;if(this.picker.append(this.html),this.view=e.defaults.views,this.calendar=this.picker.find(".calendar"),this.header=this.calendar.find(".calendar-head"),this.daypicker=this.calendar.find(".calendar-days"),this.monthpicker=this.calendar.find(".calendar-months"),this.yearpicker=this.calendar.find(".calendar-years"),this.selected_date=this.current_date=e.defaults.date,"single"==e.defaults.mode)this.current_day=[this.current_date[0].getDate()],this.current_month=[this.current_date[0].getMonth()],this.current_year=[this.current_date[0].getFullYear()],this.selected_day=[this.selected_date[0].getDate()],this.selected_month=[this.selected_date[0].getMonth()],this.selected_year=[this.selected_date[0].getFullYear()],this.manage_views(0),this.set_value();else{"range"==e.defaults.mode&&(e.defaults.date[1]=new Date(e.defaults.date[1]),this.current_day=[this.current_date[0].getDate(),this.current_date[1].getDate()],this.current_month=[this.current_date[0].getMonth(),this.current_date[1].getMonth()],this.current_year=[this.current_date[0].getFullYear(),this.current_date[1].getFullYear()],this.selected_day=[this.selected_date[0].getDate(),this.selected_date[1].getDate()],this.selected_month=[this.selected_date[0].getMonth(),this.selected_date[1].getMonth()],this.selected_year=[this.selected_date[0].getFullYear(),this.selected_date[1].getFullYear()],this.set_value());for(var s=0;e.defaults.calendars>s;s++)this.view[s]===void 0&&(this.view[s]="days"),this.manage_views(s)}this.manage_views()},show:function(){this.picker.show(),this.place();var e=this;t(window).scroll(function(){e.place()}),t(document).on("mousedown",function(s){0==t(s.target).closest(".calendar").length&&e.hide()})},hide:function(){this.picker.hide()},place:function(){var t=window.innerHeight,e=window.innerWidth,s=this.picker.outerHeight(),a=this.picker.outerWidth(),i=this.el.offset().top,r=this.el.offset().left,h=this.el.outerHeight(),n=this.el.outerWidth(),c=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;scroll_left=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,to_top=i-c,to_bottom=t-to_top-h,to_left=r-scroll_left,to_right=e-to_left-n,to_bottom>s?to_right>a-n?this.picker.css({left:to_left,top:to_top+h}):to_left>a-n?this.picker.css({left:to_left+n-a,top:to_top+h}):this.picker.css({left:to_left,top:to_top+h}):to_top>s?to_right>a-n?this.picker.css({left:to_left,top:to_top-s}):to_left>a-n?this.picker.css({left:to_left+n-a,top:to_top-s}):this.picker.css({left:to_left,top:to_top-s}):to_right>a-n?this.picker.css({left:to_left,top:to_top+h}):to_left>a-n?this.picker.css({left:to_left+n-a,top:to_top+h}):this.picker.css({left:to_left,top:to_top+h})},set_value:function(){if("single"==e.defaults.mode){this.date=new Date(this.selected_year[0],this.selected_month[0],this.selected_day[0],0,0,0,0);var t=this.format_date(this.date,this.format);this.el.val(t)}else if("range"==e.defaults.mode){var s=new Date(this.selected_year[0],this.selected_month[0],this.selected_day[0],0,0,0,0),a=new Date(this.selected_year[1],this.selected_month[1],this.selected_day[1],0,0,0,0),i=this.format_date(s,this.format),r=this.format_date(a,this.format);this.el.val(i+" - "+r)}},str_pad:function(t,e){for(t+="";e>t.length;)t="0"+t;return t},str_concat:function(){for(var t="",e=0;arguments.length>e;e++)t+=arguments[e]+"";return t},parse_format:function(t){var e=t.match(/[.\/\-\s].*?/),s=t.split(/\W+/)||s;if(!s||0===s.length)throw Error("Invalid date format.");return{separator:e,parts:s}},parse_date:function(t,e){var s,a=t.split(e.separator)||a,t=new Date;if(a.length===e.parts.length)for(var i=0,r=e.parts.length;r>i;i++){if(s=parseInt(a[i],10)||1,"1"===s)return;switch(e.parts[i]){case"dd":case"d":t.setDate(s);break;case"mm":case"m":t.setDate(s-1);break;case"yy":t.setFullYear(2e3+s);break;case"yyyy":t.setFullYear(s)}}return t},format_date:function(t,e){var s={d:t.getDate(),m:t.getMonth()+1,yy:(""+t.getFullYear()).substring(2),yyyy:t.getFullYear()};s.dd=(10>s.d?"0":"")+s.d,s.mm=(10>s.m?"0":"")+s.m;for(var t=[],a=0,i=e.parts.length;i>a;a++)t.push(s[e.parts[a]]);return t.join(e.separator)},generate_daypicker:function(t){var s=new Date(this.selected_year[t],this.selected_month[t]+1,0).getDate(),a=new Date(this.selected_year[t],this.selected_month[t],2).getDay(),i=new Date(this.selected_year[t],this.selected_month[t],0).getDate(),r=a-e.defaults.first_day_of_week,h='<thead><tr class="calendar-week">';r=0>r?7+r:r,this.manage_header(e.defaults.months[this.selected_month[t]]+" "+this.selected_year[t],t);for(var n=0;7>n;n++)h+="<th>"+e.defaults.days[n]+"</th>";h+="</tr></thead>",h+="<tbody><tr>";for(var n=0;42>n;n++){n>0&&0==n%7&&(h+="</tr><tr>");var c=n-r+1;h+=r>n?'<td class="otherMonthDay">'+(i-r+n+1)+"</td>":c>s?'<td class="otherMonthDay">'+(c-s)+"</td>":this.selected_month[t]==this.current_month[t]&&this.selected_year[t]==this.current_year[t]&&this.current_day[t]==c?'<td class="is-active">'+c+"</td>":"<td>"+c+"</td>"}this.daypicker.eq(t).html(h)},generate_monthpicker:function(t){this.manage_header(this.selected_year[t],t);for(var s="<tr>",a=0;12>a;a++)a>0&&0==a%3&&(s+="</tr><tr>"),s+=a==this.current_month[t]&&this.selected_year[t]==this.current_year[t]?'<td class="calendar-month-'+a+' is-active">'+e.defaults.months_short[a]+"</td>":'<td class="calendar-month-'+a+'">'+e.defaults.months_short[a]+"</td>";s+="</tr>",this.monthpicker.eq(t).html(s)},generate_yearpicker:function(t){this.manage_header(this.selected_year[t]-7+" - "+(this.selected_year[t]+4),t);for(var e="<tr>",s=0;12>s;s++)s>0&&0==s%3&&(e+="</tr><tr>"),e+=this.selected_year[t]-7+s==this.current_year[t]?'<td class="is-active">'+(this.selected_year[t]-7+s)+"</td>":"<td>"+(this.selected_year[t]-7+s)+"</td>";e+="</tr>",this.yearpicker.eq(t).html(e)},manage_header:function(t,e){this.calendar.eq(e).find(".calendar-caption").html(t);var s,a,i=this.selected_year[e],r=this.selected_month[e];"days"==this.view?(a=0>r-1?this.str_concat(i-1,"11"):this.str_concat(i,this.str_pad(r-1,2)),s=r+1>11?this.str_concat(i+1,"00"):this.str_concat(i,this.str_pad(r+1,2))):"months"==this.view?(a=i-1,s=i+2):"years"==this.view&&(a=i-7,s=i+7)},manage_views:function(t){"days"==this.view[t]?(this.generate_daypicker(t),this.daypicker.eq(t).css("display","inline-block"),this.monthpicker.eq(t).hide(),this.yearpicker.eq(t).hide()):"months"==this.view[t]?(this.generate_monthpicker(t),this.daypicker.eq(t).hide(),this.monthpicker.eq(t).css("display","inline-block"),this.yearpicker.eq(t).hide()):"years"==this.view[t]&&(this.generate_yearpicker(t),this.daypicker.eq(t).hide(),this.monthpicker.eq(t).hide(),this.yearpicker.eq(t).css("display","inline-block"))},prev:function(e){t(this).hasClass("calendar-blocked")||("months"==this.view[e]?this.selected_year[e]--:"years"==this.view[e]?this.selected_year[e]-=12:0>--this.selected_month[e]&&(this.selected_month[e]=11,this.selected_year[e]--),this.manage_views(e))},next:function(e){t(this).hasClass("calendar-blocked")||("months"==this.view[e]?this.selected_year[e]++:"years"==this.view[e]?this.selected_year[e]+=12:12==++this.selected_month[e]&&(this.selected_month[e]=0,this.selected_year[e]++),this.manage_views(e))},caption:function(t){if("days"==this.view[t])this.view[t]="months";else{if("months"!=this.view[t])return!1;this.view[t]="years"}this.manage_views(t)},click:function(e){var s=t(e.target).closest("td, th"),a=function(e,s){var a;return t.each(e,function(t,e){e==s&&(a=t)}),a};if(1===s.length)switch(s[0].nodeName.toLowerCase()){case"th":var i=s.parent().parent().parent().parent();switch(s[0].className){case"calendar-caption":var r=a(this.calendar,i.get(0));this.caption(r);break;case"calendar-prev":var r=a(this.calendar,i.get(0));this.prev(r);break;case"calendar-next":var r=a(this.calendar,i.get(0));this.next(r)}break;case"td":var h=s.parent().parent().parent().attr("class"),n=s.attr("class"),i=s.parent().parent().parent().parent();switch(h){case"calendar-days":if("otherMonthDay"!==n){var r=a(this.calendar,i.get(0)),c=parseInt(s.text(),10);this.selected_day[r]=c,this.current_day[r]=this.selected_day[r],this.current_month[r]=this.selected_month[r],this.current_year[r]=this.selected_year[r],this.manage_views(r),this.set_value(r)}break;case"calendar-months":var r=a(this.calendar,i.get(0)),d=s.attr("class").match(/calendar\-month\-([0-9]+)/);this.selected_month[r]=Number(d[1]),this.current_month[r]=this.selected_month[r],this.current_year[r]=this.selected_year[r],this.view[r]="days",this.manage_views(r),this.set_value(r);break;case"calendar-years":var r=a(this.calendar,i.get(0)),l=parseInt(s.text(),10);this.view[r]="months",this.selected_year[r]=l,this.current_year[r]=this.selected_year[r],this.manage_views(r),this.set_value(r)}}}},t.fn.datepicker=function(s){var a="datepicker",i=this.data(a);return i?s===!0?i:this:this.each(function(){return t(this).data(a,new e(this,s))})}})(jQuery);